Bootstrap: docker
From: nceglia/scrna-pipeline:dev

%help
scrna pipeline meant to be run on juno mskcc.

%setup
  apt-get update \
  && apt-get install -y python3-pip python3-dev libffi-dev build-essential  \
  && cd /usr/local/bin \
  && ln -s /usr/bin/python3 python \
  && pip3 install --upgrade pip
  python3 -m pip install tensorflow
  python3 -m pip install PyYAML
  python3 -m pip install matplotlib
  python3 -m pip install pandas
  python3 -m pip install rpy2
  python3 -m pip install networkx
  python3 -m pip install dill
  python3 -m pip install azure
  python3 -m pip install scanorama
  mkdir /results
  mkdir /runs
  git clone https://github.com/shahcompbio/scvis.git /codebase/scvis/
  cd /codebase/scvis && python3 setup.py install
  git clone https://github.com/nceglia/scrna-pipeline.git /codebase/SCRNApipeline/
  git clone https://github.com/shahcompbio/pypeliner.git /codebase/pypeliner/
  cd /codebase/pypeliner && python3 setup.py install
  Rscript /codebase/install.R

%environment
    export PATH="/codebase/cellranger-3.0.2:$PATH
    export PATH=$PATH:/common/juno/OS7/10.1/linux3.10-glibc2.17-x86_64/bin/
    export R_HOME=/usr/local/lib/R/
    export LD_LIBRARY_PATH=/usr/local/lib/R/lib/
